import{importShared as E}from"./__federation_fn_import-ROHmt-Wr.js";import{j as t}from"./useForkRef-BcC6EfDH.js";import{F as P,c as W,a as m,b as k}from"./formik.esm-BDPjx_Ed.js";import{M as F}from"./MainCard-BN-3sZL8.js";import{D as N,a as $}from"./deals-BjCyASoR.js";import{d as A}from"./deals-iLL9qn1F.js";import{u as M}from"./notistack.esm-BEBsNIld.js";import{i as v}from"./axios-D-DgzO2k.js";import{B as j}from"./Box-BoOsA6HK.js";import{C as L,d as y}from"./Button-BSxsv2fQ.js";import{A as V}from"./Alert-DviP8MUR.js";import{T as O}from"./Typography-DjCnPsjL.js";import{S as R}from"./Stack-DS-rnz-G.js";import{G as l}from"./GridLegacy-Bxmhmsx3.js";import{T as s}from"./TextField-CqP_YIjN.js";import{M as T}from"./MenuItem-Bz1fAOUH.js";const{useCallback:q,useEffect:z,useMemo:G,useState:D}=await E("react"),{useNavigate:U,useParams:_}=await E("react-router-dom"),H=W().shape({name:m().required("Name is required"),amount:k().typeError("Amount must be a number").min(0,"Amount must be positive").required("Amount is required"),stage:m().required("Stage is required"),status:m().required("Status is required"),probability:k().typeError("Probability must be a number").min(0,"Probability must be at least 0%").max(100,"Probability must be at most 100%").nullable(),ownerId:m().required("Owner is required"),companyId:m().nullable(),contactId:m().nullable(),closeDate:m().nullable(),description:m().nullable()});function J(e){return{name:e.name,amount:e.amount??"",stage:e.stage??"",status:e.status??"",probability:e.probability===null||e.probability===void 0?"":e.probability>1?e.probability:e.probability*100,ownerId:e.ownerId,companyId:e.companyId??"",contactId:e.contactId??"",closeDate:e.closeDate?e.closeDate.slice(0,10):"",description:e.description??""}}function K(e){const i=e.probability===""?null:Number(e.probability);return{name:e.name,amount:e.amount===""?void 0:Number(e.amount),stage:e.stage,status:e.status,probability:i===null||Number.isNaN(i)?null:i>1?i/100:i,ownerId:e.ownerId,companyId:e.companyId.trim()===""?null:e.companyId.trim(),contactId:e.contactId.trim()===""?null:e.contactId.trim(),closeDate:e.closeDate?new Date(e.closeDate).toISOString():null,description:e.description.trim()===""?null:e.description.trim()}}function Q(e){if(!e)return!1;const i=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[089abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/,d=/^\d+$/;return i.test(e)||d.test(e)}function X(e){if(e&&typeof e=="object"&&"message"in e){const i=e.message;if(i)return i}return"Failed to update deal."}function Y(e){if(e&&typeof e=="object"&&"errors"in e){const i=e.errors;if(i&&typeof i=="object"){const d={};return Object.entries(i).forEach(([p,b])=>{Array.isArray(b)&&b.length>0&&(d[p]=b[0])}),d}}return null}function fe(){const{id:e}=_(),i=U(),{enqueueSnackbar:d}=M(),[p,b]=D(null),[g,I]=D(!0),[f,x]=D(null),h=q(async()=>{if(!Q(e)){x({kind:"not-found",message:"The requested deal could not be found."}),I(!1);return}I(!0);try{const c=await A.getDeal(e);b(c),x(null)}catch(c){v(c)?c.response?.status===404?x({kind:"not-found",message:"The requested deal could not be found."}):x({kind:"network",message:c.response?.data?.message??"We could not load this deal. Please try again in a moment."}):x({kind:"network",message:"We could not load this deal. Please try again in a moment."})}finally{I(!1)}},[e]);z(()=>{h()},[h]);const w=G(()=>p?J(p):null,[p]),C=q(async(c,o)=>{if(!e){d("Unable to update deal: missing identifier.",{variant:"error"}),o.setSubmitting(!1);return}try{const r=K(c);await A.updateDeal(e,r),d("Deal updated successfully.",{variant:"success"}),i(`/deals/${e}`)}catch(r){const a=Y(r);a&&o.setErrors(a),d(X(r),{variant:"error"})}finally{o.setSubmitting(!1)}},[d,e,i]);return t.jsxs(F,{title:"Edit Deal",secondary:t.jsx(y,{variant:"outlined",onClick:()=>i(e?`/deals/${e}`:"/deals"),children:"Cancel"}),children:[g&&t.jsx(j,{sx:{display:"flex",justifyContent:"center",py:6},children:t.jsx(L,{})}),!g&&f&&t.jsx(V,{severity:f.kind==="network"?"error":"warning",children:t.jsxs(j,{sx:{display:"flex",flexDirection:"column",gap:1},children:[t.jsx(O,{variant:"body2",children:f.message}),t.jsxs(j,{sx:{display:"flex",gap:1},children:[f.kind==="network"&&t.jsx(y,{size:"small",onClick:()=>void h(),variant:"outlined",children:"Retry"}),t.jsx(y,{size:"small",variant:"contained",onClick:()=>i("/deals"),children:"Back to Deals"})]})]})}),!g&&!f&&w&&t.jsx(P,{initialValues:w,enableReinitialize:!0,validationSchema:H,onSubmit:C,children:({handleSubmit:c,values:o,handleChange:r,touched:a,errors:n,isSubmitting:S,dirty:B})=>t.jsx("form",{noValidate:!0,onSubmit:c,children:t.jsxs(R,{spacing:3,children:[t.jsxs(l,{container:!0,spacing:2,children:[t.jsx(l,{xs:12,md:6,children:t.jsx(s,{label:"Name",name:"name",value:o.name,onChange:r,error:a.name&&!!n.name,helperText:a.name&&n.name,fullWidth:!0,required:!0})}),t.jsx(l,{xs:12,md:6,children:t.jsx(s,{label:"Amount",name:"amount",value:o.amount,onChange:r,error:a.amount&&!!n.amount,helperText:a.amount&&n.amount,fullWidth:!0,type:"number",inputProps:{min:0,step:.01},required:!0})}),t.jsx(l,{xs:12,md:6,children:t.jsx(s,{label:"Stage",name:"stage",value:o.stage,onChange:r,error:a.stage&&!!n.stage,helperText:a.stage&&n.stage,fullWidth:!0,required:!0,select:!0,children:N.map(u=>t.jsx(T,{value:u,children:u},u))})}),t.jsx(l,{xs:12,md:6,children:t.jsx(s,{label:"Status",name:"status",value:o.status,onChange:r,error:a.status&&!!n.status,helperText:a.status&&n.status,fullWidth:!0,required:!0,select:!0,children:$.map(u=>t.jsx(T,{value:u,children:u},u))})}),t.jsx(l,{xs:12,md:6,children:t.jsx(s,{label:"Probability (%)",name:"probability",value:o.probability,onChange:r,error:a.probability&&!!n.probability,helperText:a.probability&&n.probability?n.probability:"Enter a probability between 0 and 100 percent.",fullWidth:!0,type:"number",inputProps:{min:0,max:100}})}),t.jsx(l,{xs:12,md:6,children:t.jsx(s,{label:"Owner ID",name:"ownerId",value:o.ownerId,onChange:r,error:a.ownerId&&!!n.ownerId,helperText:a.ownerId&&n.ownerId,fullWidth:!0,required:!0})}),t.jsx(l,{xs:12,md:6,children:t.jsx(s,{label:"Company ID",name:"companyId",value:o.companyId,onChange:r,error:a.companyId&&!!n.companyId,helperText:a.companyId&&n.companyId,fullWidth:!0})}),t.jsx(l,{xs:12,md:6,children:t.jsx(s,{label:"Contact ID",name:"contactId",value:o.contactId,onChange:r,error:a.contactId&&!!n.contactId,helperText:a.contactId&&n.contactId,fullWidth:!0})}),t.jsx(l,{xs:12,md:6,children:t.jsx(s,{label:"Close Date",name:"closeDate",value:o.closeDate,onChange:r,error:a.closeDate&&!!n.closeDate,helperText:a.closeDate&&n.closeDate,fullWidth:!0,type:"date",InputLabelProps:{shrink:!0}})}),t.jsx(l,{xs:12,children:t.jsx(s,{label:"Description",name:"description",value:o.description,onChange:r,error:a.description&&!!n.description,helperText:a.description&&n.description,fullWidth:!0,multiline:!0,minRows:3})})]}),t.jsxs(j,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[t.jsx(y,{variant:"outlined",onClick:()=>i(e?`/deals/${e}`:"/deals"),disabled:S,children:"Cancel"}),t.jsx(y,{variant:"contained",type:"submit",disabled:S||!B,children:"Save Changes"})]})]})})})]})}export{fe as default};
//# sourceMappingURL=DealEditPage-3K-1PjiL.js.map
