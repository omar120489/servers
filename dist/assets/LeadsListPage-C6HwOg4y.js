import{importShared as M}from"./__federation_fn_import-CJIdJiQv.js";import{j as t}from"./useForkRef-BC7kqYKT.js";import{S as ne,R as ie}from"./typeof-1JE7jPjq.js";import{P as le}from"./PersonAddAlt1-D73X94MS.js";import{u as ce}from"./notistack.esm-68WP7i0D.js";import{M as de}from"./MainCard-BRoTQIrC.js";import{u as ue,a as me,b as q,e as he,c as fe,E as pe,F as xe}from"./exporters-DztMca4u.js";import{l as W}from"./leads-BgdtH0Oz.js";import{B as P}from"./Box-DmbfI6Tx.js";import{T as ge}from"./TextField-HqD_g_zo.js";import{I as ve}from"./InputAdornment-D_aBeDhu.js";import{d as L}from"./Button-Bgis-uOM.js";import{S as _e}from"./Stack-B5BVBH1D.js";import{C as O}from"./Chip-clCeHopq.js";import{A as ye}from"./Alert-C9XT2yne.js";import{P as je}from"./Paper-CeqRlO8T.js";import{L as be}from"./LinearProgress-BaGLU8ch.js";import{b as Se,T as Pe,c as we,d as I,a as Ce}from"./TableRow-DYcKugvt.js";import{a as l}from"./TableCell-DUk3nzYY.js";import{T as $}from"./Typography-DFd_zA1D.js";import{T as Ne}from"./TablePagination-BZDVOF0V.js";const{useCallback:w,useEffect:Ee,useMemo:Fe,useState:A}=await M("react"),U={page:1,size:10,search:""};function Le(n){const[j,C]=A(()=>({...U,...n?.initialQuery??{}})),[N,r]=A(null),[d,x]=A(!1),[u,g]=A(null),h=Fe(()=>({...U,...j}),[j]),v=w(async c=>{const o=await W.listLeads(c);r(o),g(null)},[]),s=w(async c=>{x(!0);try{await v(c)}catch(o){throw g(o),o}finally{x(!1)}},[v]);Ee(()=>{let c=!0;return x(!0),W.listLeads(h).then(o=>{c&&(r(o),g(null))}).catch(o=>{c&&g(o)}).finally(()=>{c&&x(!1)}),()=>{c=!1}},[h]);const i=w(c=>{C(o=>({...o,...c}))},[]),E=w(c=>{C(o=>c(o))},[]),z=w(async()=>{await s(h)},[s,h]);return{leads:N?.items??[],data:N,loading:d,error:u,query:h,updateQuery:i,setQuery:E,refetch:z}}const{useCallback:m,useEffect:Ae,useMemo:T,useState:X}=await M("react"),{Link:R,useSearchParams:Te}=await M("react-router-dom"),ze={new:"default",contacted:"info",qualified:"success",working:"info",converted:"success",unqualified:"error"};function De(n){return n?ze[n.toLowerCase()]??"default":"default"}function ke(n){return n==null||Number.isNaN(n)?"—":`${Math.round(n)}%`}function Ie(n){return n?new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric"}).format(new Date(n)):"—"}const y=10,$e=[{label:"Created Date",type:"date-range",field:"date"},{label:"Score",type:"number-range",field:"score"},{label:"Statuses",type:"multi-select",field:"statuses",options:[{value:"New",label:"New"},{value:"Contacted",label:"Contacted"},{value:"Qualified",label:"Qualified"},{value:"Working",label:"Working"},{value:"Converted",label:"Converted"},{value:"Unqualified",label:"Unqualified"}]},{label:"Sources",type:"multi-select",field:"sources",options:[{value:"Web",label:"Web"},{value:"Referral",label:"Referral"},{value:"Email",label:"Email"},{value:"Phone",label:"Phone"},{value:"Event",label:"Event"},{value:"Social",label:"Social"}]}];function ot(){const[n,j]=Te(),{presets:C,savePreset:N}=ue("leads-filter-presets"),[r,d]=X({}),x=T(()=>{const e=(S,p)=>{const k=Number(n.get(S));return Number.isFinite(k)&&k>0?k:p},a=S=>{const p=n.get(S);return p&&p.trim().length>0?p:void 0},f=S=>{const p=n.get(S);return p?p.split(","):[]},b={date_from:a("date_from"),date_to:a("date_to"),score_min:n.get("score_min")?Number(n.get("score_min")):void 0,score_max:n.get("score_max")?Number(n.get("score_max")):void 0,statuses:f("statuses"),sources:f("sources")};return d(b),{page:e("page",1),size:e("size",y),search:n.get("search")??"",date_from:a("date_from"),date_to:a("date_to"),score_min:n.get("score_min")?Number(n.get("score_min")):void 0,score_max:n.get("score_max")?Number(n.get("score_max")):void 0,statuses:a("statuses"),sources:a("sources"),dateFrom:a("dateFrom"),dateTo:a("dateTo"),ownerId:a("ownerId")}},[n]),{leads:u,data:g,loading:h,error:v,query:s,updateQuery:i,refetch:E}=Le({initialQuery:x}),[z,c]=X(s.search??"");Ae(()=>{const e=s.search??"";c(a=>a===e?a:e)},[s.search]);const o=m(e=>{const a=new URLSearchParams(n);for(const[f,b]of Object.entries(e))b===void 0||b===""?a.delete(f):a.set(f,b);j(a)},[n,j]),B=m((e,a)=>{const f=a+1;i({page:f}),o({page:String(f),size:String(s.size??y)})},[s.size,o,i]),V=m(e=>{const a=Number(e.target.value)||y;i({page:1,size:a}),o({page:"1",size:String(a)})},[o,i]),G=m(e=>{const a=e.target.value;c(a),i({page:1,search:a});const f=a.trim();o({search:f.length>0?a:void 0,page:"1",size:String(s.size??y)})},[s.size,o,i]),H=m(()=>{E()},[E]),Y=m(e=>{d(e)},[]),Z=m(()=>{const e={page:"1",date_from:r.date_from,date_to:r.date_to,score_min:r.score_min===void 0?void 0:String(r.score_min),score_max:r.score_max===void 0?void 0:String(r.score_max),statuses:Array.isArray(r.statuses)&&r.statuses.length>0?r.statuses.join(","):void 0,sources:Array.isArray(r.sources)&&r.sources.length>0?r.sources.join(","):void 0};o(e),i({...s,page:1,date_from:r.date_from,date_to:r.date_to,score_min:r.score_min,score_max:r.score_max,statuses:Array.isArray(r.statuses)&&r.statuses.length>0?r.statuses.join(","):void 0,sources:Array.isArray(r.sources)&&r.sources.length>0?r.sources.join(","):void 0})},[r,s,o,i]),J=m(e=>{d(e)},[]),K=m(()=>{const e=s.size??y;d({}),i({page:1,size:e,search:"",dateFrom:void 0,dateTo:void 0,ownerId:void 0,date_from:void 0,date_to:void 0,score_min:void 0,score_max:void 0,statuses:void 0,sources:void 0}),c(""),o({page:"1",size:String(e),search:void 0,dateFrom:void 0,dateTo:void 0,ownerId:void 0,stage:void 0,date_from:void 0,date_to:void 0,score_min:void 0,score_max:void 0,statuses:void 0,sources:void 0})},[s.size,o,i]),Q=T(()=>{const e=[];return s.date_from&&e.push({key:"date_from",label:`From: ${s.date_from}`,onDelete:()=>{const a={...r,date_from:void 0};d(a),o({date_from:void 0}),i({...s,date_from:void 0})}}),s.date_to&&e.push({key:"date_to",label:`To: ${s.date_to}`,onDelete:()=>{const a={...r,date_to:void 0};d(a),o({date_to:void 0}),i({...s,date_to:void 0})}}),s.score_min&&e.push({key:"score_min",label:`Min Score: ${s.score_min}`,onDelete:()=>{const a={...r,score_min:void 0};d(a),o({score_min:void 0}),i({...s,score_min:void 0})}}),s.score_max&&e.push({key:"score_max",label:`Max Score: ${s.score_max}`,onDelete:()=>{const a={...r,score_max:void 0};d(a),o({score_max:void 0}),i({...s,score_max:void 0})}}),s.statuses&&e.push({key:"statuses",label:`Statuses: ${s.statuses}`,onDelete:()=>{const a={...r,statuses:[]};d(a),o({statuses:void 0}),i({...s,statuses:void 0})}}),s.sources&&e.push({key:"sources",label:`Sources: ${s.sources}`,onDelete:()=>{const a={...r,sources:[]};d(a),o({sources:void 0}),i({...s,sources:void 0})}}),e},[s,r,o,i]),D=T(()=>u,[u]),ee=g?.total??D.length,te=Math.max(0,(s.page??1)-1),se=s.size??y,{enqueueSnackbar:_}=ce(),F=T(()=>[{field:"id",headerName:"ID"},{field:"firstName",headerName:"First Name"},{field:"lastName",headerName:"Last Name"},{field:"email",headerName:"Email"},{field:"phone",headerName:"Phone"},{field:"company",headerName:"Company"},{field:"status",headerName:"Status"},{field:"source",headerName:"Source"},{field:"score",headerName:"Score",valueFormatter:e=>e==null?"—":`${e}%`},{field:"createdAt",headerName:"Created",valueFormatter:me}],[]),ae=m(()=>{try{const e=q("leads","xlsx",s.search?{search:s.search}:void 0);he(u,F,e),_(`Exported ${u.length} leads to ${e}`,{variant:"success"})}catch(e){console.error("Export failed:",e),_("Export failed. Please try again.",{variant:"error"})}},[u,F,s.search,_]),re=m(()=>{try{const e=q("leads","pdf",s.search?{search:s.search}:void 0);fe(u,F,e,"Leads Report"),_(`Exported ${u.length} leads to ${e}`,{variant:"success"})}catch(e){console.error("Export failed:",e),_("Export failed. Please try again.",{variant:"error"})}},[u,F,s.search,_]),oe=t.jsx(L,{component:R,to:"/leads/new",variant:"contained",startIcon:t.jsx(le,{}),children:"New Lead"});return t.jsx(de,{title:"Leads",content:!1,children:t.jsxs(P,{sx:{display:"flex",flexDirection:"column",gap:2,p:3},children:[t.jsxs(P,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,alignItems:{xs:"stretch",md:"center"},justifyContent:"space-between"},children:[t.jsx(ge,{fullWidth:!0,placeholder:"Search leads",value:z,onChange:G,slotProps:{input:{startAdornment:t.jsx(ve,{position:"start",children:t.jsx(ne,{fontSize:"small"})})}}}),t.jsxs(P,{sx:{display:"flex",flexDirection:"row",gap:1.5,justifyContent:{xs:"flex-start",md:"flex-end"}},children:[t.jsx(pe,{onExportXLSX:ae,onExportPDF:re,disabled:h||u.length===0}),t.jsx(L,{variant:"outlined",startIcon:t.jsx(ie,{}),onClick:H,disabled:h,children:"Refresh"}),oe]})]}),t.jsx(xe,{filters:$e,values:r,onChange:Y,onApply:Z,onClear:K,showPresets:!0,presets:C,onSavePreset:N,onLoadPreset:J}),Q.length>0&&t.jsx(_e,{direction:"row",spacing:1,flexWrap:"wrap",sx:{gap:1},children:Q.map(e=>t.jsx(O,{label:e.label,onDelete:e.onDelete,color:"primary",size:"small"},e.key))}),!!v&&t.jsx(ye,{severity:"error",children:v instanceof Error?v.message:"Failed to load leads. Please try again."}),t.jsxs(je,{variant:"outlined",children:[h&&t.jsx(be,{}),t.jsx(Se,{children:t.jsxs(Pe,{size:"medium",children:[t.jsx(we,{children:t.jsxs(I,{children:[t.jsx(l,{children:"Name"}),t.jsx(l,{children:"Email"}),t.jsx(l,{children:"Phone"}),t.jsx(l,{children:"Company"}),t.jsx(l,{children:"Status"}),t.jsx(l,{children:"Source"}),t.jsx(l,{align:"right",children:"Score"}),t.jsx(l,{children:"Created"}),t.jsx(l,{align:"right",children:"Actions"})]})}),t.jsx(Ce,{children:D.length===0&&!h?t.jsx(I,{children:t.jsx(l,{colSpan:9,align:"center",children:t.jsx($,{variant:"body2",color:"text.secondary",children:"No leads found."})})}):D.map(e=>t.jsxs(I,{hover:!0,children:[t.jsx(l,{children:t.jsxs(P,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[t.jsxs($,{variant:"subtitle1",fontWeight:600,children:[e.firstName," ",e.lastName]}),t.jsxs($,{variant:"caption",color:"text.secondary",children:["Owner: ",e.ownerId??"—"]})]})}),t.jsx(l,{children:e.email}),t.jsx(l,{children:e.phone??"—"}),t.jsx(l,{children:e.company??"—"}),t.jsx(l,{children:t.jsx(O,{label:e.status??"—",size:"small",color:De(e.status)})}),t.jsx(l,{children:e.source??"—"}),t.jsx(l,{align:"right",children:ke(e.score)}),t.jsx(l,{children:Ie(e.createdAt)}),t.jsx(l,{align:"right",children:t.jsxs(P,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[t.jsx(L,{component:R,to:`/leads/${e.id}`,size:"small",children:"View"}),t.jsx(L,{component:R,to:`/leads/${e.id}/edit`,size:"small",color:"secondary",children:"Edit"})]})})]},e.id))})]})}),t.jsx(Ne,{component:"div",count:ee,page:te,onPageChange:B,rowsPerPage:se,onRowsPerPageChange:V,rowsPerPageOptions:[5,10,25,50]})]})]})})}export{ot as default};
//# sourceMappingURL=LeadsListPage-C6HwOg4y.js.map
