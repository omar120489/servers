import{importShared as N}from"./__federation_fn_import-CJIdJiQv.js";import{j as t}from"./useForkRef-BC7kqYKT.js";import{S as B,R as U}from"./typeof-1JE7jPjq.js";import{P as G}from"./PersonAddAlt1-D73X94MS.js";import{M as O}from"./MainCard-BRoTQIrC.js";import{a as R,b as _,c as q,d as H}from"./axios-CKLPSsiI.js";import{B as p}from"./Box-DmbfI6Tx.js";import{T as x}from"./Typography-DFd_zA1D.js";import{C as W}from"./Chip-clCeHopq.js";import{d as I}from"./Button-Bgis-uOM.js";import{T as V}from"./TextField-HqD_g_zo.js";import{I as Y}from"./InputAdornment-D_aBeDhu.js";import{A as Z}from"./Alert-C9XT2yne.js";import{D as J}from"./DataGrid-BjTICiuR.js";const v="/api/contacts";async function K(n){return R(v,{params:n})}async function X(n){return R(`${v}/${n}`)}async function ee(n){return H(v,n)}async function te(n,h){return q(`${v}/${n}`,h)}async function ne(n){return _(`${v}/${n}`)}const M={listContacts:K,getContact:X,createContact:ee,updateContact:te,deleteContact:ne},{useCallback:w,useEffect:ae,useMemo:re,useState:b}=await N("react"),L={page:1,size:10,search:""};function oe(n){const[h,S]=b(()=>({...L,...n?.initialQuery??{}})),[f,g]=b(null),[z,m]=b(!1),[a,c]=b(null),u=re(()=>({...L,...h}),[h]),l=w(async s=>{const o=await M.listContacts(s);g(o),c(null)},[]),y=w(async s=>{m(!0);try{await l(s)}catch(o){throw c(o),o}finally{m(!1)}},[l]);ae(()=>{let s=!0;return m(!0),M.listContacts(u).then(o=>{s&&(g(o),c(null))}).catch(o=>{s&&c(o)}).finally(()=>{s&&m(!1)}),()=>{s=!1}},[u]);const D=w(s=>{S(o=>({...o,...s}))},[]),F=w(s=>{S(o=>({...o,...s(o)}))},[]),A=w(async()=>{await y(u)},[y,u]);return{contacts:f?.items??[],data:f,loading:z,error:a,query:u,updateQuery:D,setQuery:F,refetch:A}}const{useCallback:C,useMemo:j}=await N("react"),{Link:E,useSearchParams:se}=await N("react-router-dom"),P=10;function ie(n){return n?new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric"}).format(new Date(n)):"—"}function ce(n){return n||"—"}function Se(){const[n,h]=se(),S=j(()=>{const e=(i,d)=>{const T=Number(n.get(i));return Number.isFinite(T)&&T>0?T:d},r=i=>{const d=n.get(i);return d&&d.trim().length>0?d:void 0};return{page:e("page",1),size:e("size",P),search:n.get("search")??"",dateFrom:r("dateFrom"),dateTo:r("dateTo"),ownerId:r("ownerId")}},[n]),{contacts:f,data:g,loading:z,error:m,query:a,updateQuery:c,refetch:u}=oe({initialQuery:S}),l=C(e=>{const r=new URLSearchParams(n);Object.entries(e).forEach(([i,d])=>{d===void 0||d===""?r.delete(i):r.set(i,d)}),h(r)},[n,h]),y=j(()=>{const e=n.get("stage");return e&&e.trim().length>0?e:void 0},[n]),D=j(()=>({page:Math.max(0,(a.page??1)-1),pageSize:a.size??P}),[a.page,a.size]),F=C(e=>{const r=e.page+1,i=e.pageSize;c({page:r,size:i}),l({page:String(r),size:String(i)})},[l,c]),A=C(e=>{const r=e.target.value;c({search:r,page:1});const i=r.trim();l({search:i.length>0?r:void 0,page:"1",size:String(a.size??P)})},[a.size,l,c]),s=C(()=>{u()},[u]),o=j(()=>!!((a.search??"").trim()||a.dateFrom||a.dateTo||a.ownerId||y),[a.dateFrom,a.dateTo,a.ownerId,a.search,y]),$=C(()=>{const e=a.size??P;c({page:1,size:e,search:"",dateFrom:void 0,dateTo:void 0,ownerId:void 0}),l({page:"1",size:String(e),search:void 0,dateFrom:void 0,dateTo:void 0,ownerId:void 0,stage:void 0})},[a.size,l,c]),k=j(()=>[{field:"name",headerName:"Contact",flex:1,minWidth:220,renderCell:e=>t.jsxs(p,{sx:{display:"flex",flexDirection:"column",gap:.25},children:[t.jsxs(x,{variant:"subtitle1",fontWeight:600,noWrap:!0,children:[e.row.firstName," ",e.row.lastName]}),t.jsxs(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:["Owner: ",e.row.ownerId??"—"]})]})},{field:"email",headerName:"Email",flex:1,minWidth:220},{field:"phone",headerName:"Phone",flex:.6,minWidth:140,renderCell:e=>t.jsx(x,{variant:"body2",noWrap:!0,children:ce(e.row.phone)})},{field:"title",headerName:"Title",flex:.8,minWidth:160,renderCell:e=>t.jsx(x,{variant:"body2",noWrap:!0,children:e.row.title??"—"})},{field:"companyId",headerName:"Company",flex:.8,minWidth:160,renderCell:e=>e.row.companyId?t.jsx(W,{label:e.row.companyId,size:"small",variant:"outlined"}):t.jsx(W,{label:"—",size:"small",variant:"outlined"})},{field:"updatedAt",headerName:"Updated",flex:.7,minWidth:150,renderCell:e=>t.jsx(x,{variant:"body2",noWrap:!0,children:ie(e.row.updatedAt)})},{field:"actions",headerName:"Actions",sortable:!1,filterable:!1,minWidth:160,align:"right",disableColumnMenu:!0,renderCell:e=>{const r=t.jsx(I,{component:E,to:`/contacts/${e.row.id}`,size:"small",children:"View"}),i=t.jsx(I,{component:E,to:`/contacts/${e.row.id}/edit`,size:"small",color:"secondary",children:"Edit"});return t.jsxs(p,{sx:{display:"flex",flexDirection:"row",gap:1},children:[r,i]})}}],[]),Q=t.jsx(I,{component:E,to:"/contacts/new",variant:"contained",startIcon:t.jsx(G,{}),children:"New Contact"});return t.jsx(O,{title:"Contacts",content:!1,children:t.jsxs(p,{sx:{display:"flex",flexDirection:"column",gap:2,p:3},children:[t.jsxs(p,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,alignItems:{xs:"stretch",md:"center"},justifyContent:"space-between"},children:[t.jsx(V,{fullWidth:!0,placeholder:"Search contacts",value:a.search??"",onChange:A,InputProps:{startAdornment:t.jsx(Y,{position:"start",children:t.jsx(B,{fontSize:"small"})})}}),t.jsxs(p,{sx:{display:"flex",flexDirection:"row",gap:1.5,justifyContent:{xs:"flex-start",md:"flex-end"}},children:[t.jsx(I,{variant:"outlined",startIcon:t.jsx(U,{}),onClick:s,disabled:z,children:"Refresh"}),Q]})]}),o&&t.jsx(W,{label:"Active filters",onDelete:$,color:"primary",size:"small",sx:{alignSelf:"flex-start"}}),!!m&&t.jsx(Z,{severity:"error",children:m instanceof Error?m.message:"Failed to load contacts. Please try again."}),t.jsx("div",{style:{width:"100%"},children:t.jsx(J,{autoHeight:!0,disableColumnMenu:!0,disableRowSelectionOnClick:!0,rows:f,columns:k,loading:z,getRowId:e=>e.id,paginationMode:"server",paginationModel:D,onPaginationModelChange:F,rowCount:g?.total??f.length,pageSizeOptions:[5,10,25,50],sx:{"& .MuiDataGrid-cell":{outline:"none !important"}}})}),t.jsx(p,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1,alignItems:{xs:"flex-start",sm:"center"}},children:t.jsxs(x,{variant:"caption",color:"text.secondary",children:["Showing ",f.length," of ",g?.total??0," contacts"]})})]})})}export{Se as default};
//# sourceMappingURL=ContactsListPage-B9R80sE7.js.map
