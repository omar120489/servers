const o=[];for(let t=0;t<256;++t)o.push((t+256).toString(16).slice(1));function d(t,e=0){return(o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]).toLowerCase()}let m;const g=new Uint8Array(16);function p(){if(!m){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");m=crypto.getRandomValues.bind(crypto)}return m(g)}const l=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),s={randomUUID:l};function _(t,e,i){t=t||{};const n=t.random??t.rng?.()??p();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,d(n)}function I(t,e,i){return s.randomUUID&&!t?s.randomUUID():_(t)}const r={UTI:"traffic_crm_uti",ATTRIBUTION:"traffic_crm_attribution",SENT_FLAG:"traffic_crm_attribution_sent"};function S(){return I()}function T(){let t=sessionStorage.getItem(r.UTI);return t||(t=S(),sessionStorage.setItem(r.UTI,t)),t}function U(){const t=new URLSearchParams(globalThis.location.search),e={source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,campaign:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0},i={ad_id:t.get("ad_id")||void 0,adset_id:t.get("adset_id")||void 0,campaign_id:t.get("campaign_id")||void 0},n=Object.values(e).some(a=>a!==void 0),u=Object.values(i).some(a=>a!==void 0);return{...n&&{utm:e},...u&&{platform:i}}}function b(){const t=T(),e=U(),i=sessionStorage.getItem(r.ATTRIBUTION);let n=null;try{i&&(n=JSON.parse(i))}catch(c){console.warn("[Attribution] Failed to parse existing attribution:",c)}const u=e.utm||e.platform,a={uti:t,utm:{source:e.utm?.source??n?.utm?.source,medium:e.utm?.medium??n?.utm?.medium,campaign:e.utm?.campaign??n?.utm?.campaign,term:e.utm?.term??n?.utm?.term,content:e.utm?.content??n?.utm?.content},platform:{ad_id:e.platform?.ad_id??n?.platform?.ad_id,adset_id:e.platform?.adset_id??n?.platform?.adset_id,campaign_id:e.platform?.campaign_id??n?.platform?.campaign_id},captured_at:u?new Date().toISOString():n?.captured_at||new Date().toISOString()};return sessionStorage.setItem(r.ATTRIBUTION,JSON.stringify(a)),a}function f(){if(sessionStorage.getItem(r.SENT_FLAG)==="true")return null;const e=sessionStorage.getItem(r.ATTRIBUTION);if(!e)return null;try{return JSON.parse(e)}catch(i){return console.error("[Attribution] Failed to parse attribution payload:",i),null}}function y(){sessionStorage.setItem(r.SENT_FLAG,"true")}export{f as g,y as m,b as p};
//# sourceMappingURL=attribution-BSL5szA1.js.map
