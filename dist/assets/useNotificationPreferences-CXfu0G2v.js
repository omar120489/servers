import{c as I}from"./createReactComponent-RpECKCBP.js";import{importShared as M}from"./__federation_fn_import-CJIdJiQv.js";import{a as J,c as E,d as K}from"./axios-CKLPSsiI.js";import{u as L}from"./useWebSocketEvents-BBdHp8NF.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M10 5a2 2 0 1 1 4 0a7 7 0 0 1 4 6v3a4 4 0 0 0 2 3h-16a4 4 0 0 0 2 -3v-3a7 7 0 0 1 4 -6",key:"svg-0"}],["path",{d:"M9 17v1a3 3 0 0 0 6 0v-1",key:"svg-1"}]],ie=I("outline","bell","Bell",U);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z",key:"svg-0"}],["path",{d:"M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-1"}]],oe=I("outline","settings","Settings",W);function _(e){return{id:e.id,title:e.title,message:e.message,type:e.type,isRead:e.is_read,userId:e.user_id,entityType:e.entity_type,entityId:e.entity_id,createdAt:e.created_at,updatedAt:e.updated_at}}function Y(e){return{title:e.title,message:e.message,type:e.type,entity_type:e.entityType,entity_id:e.entityId}}async function j(){const e=await J("/api/v1/notifications");return{items:e.items.map(_),total:e.total}}async function q(e){const a=Y(e),r=await K("/api/v1/notifications",a);return _(r)}async function H(e){const a=await E(`/api/v1/notifications/${e}/read`,{});return _(a)}async function Q(){await E("/api/v1/notifications/mark-all-read",{})}const S={listNotifications:j,createNotification:q,markAsRead:H,markAllAsRead:Q},P=(e,a=1440*60*1e3)=>{const r=new Date(e).getTime();return Number.isFinite(r)&&Date.now()-r<=a},{useCallback:y,useEffect:f,useMemo:w,useState:m}=await M("react");function re(){const[e,a]=m([]),[r,g]=m(!1),[b,N]=m(null),[i,c]=m(1),[l,R]=m(10),[h,$]=m("all"),{subscribe:d}=L(),D=w(()=>e.filter(t=>!t.isRead).length,[e]),p=w(()=>{switch(h){case"new":return e.filter(t=>P(t.createdAt));case"unread":return e.filter(t=>!t.isRead);case"other":return e.filter(t=>t.isRead||!P(t.createdAt));case"all":default:return e}},[e,h]),k=w(()=>Math.ceil(p.length/l),[p.length,l]),x=w(()=>{const t=(i-1)*l,s=t+l;return p.slice(t,s)},[p,i,l]),o=y(async()=>{g(!0);try{const t=await S.listNotifications();a(t.items),N(null)}catch(t){throw N(t),console.error("[useNotifications] Failed to load notifications:",t),t}finally{g(!1)}},[]);f(()=>{o()},[o]),f(()=>d("notification:new",s=>{try{const n=s;a(u=>[n,...u])}catch(n){console.error("[useNotifications] Failed to handle notification:new event:",n)}}),[d]),f(()=>{const t=u=>{a(T=>T.map(v=>v.id===u?{...v,isRead:!0}:v))};return d("notification:read",u=>{const{id:T}=u;t(T)})},[d]),f(()=>d("notifications:all-read",()=>{a(n=>n.map(u=>({...u,isRead:!0})))}),[d]);const z=y(async()=>{await o()},[o]),O=y(async t=>{a(s=>s.map(n=>n.id===t?{...n,isRead:!0}:n));try{await S.markAsRead(t)}catch(s){throw console.error("[useNotifications] Failed to mark notification as read:",s),await o(),s}},[o]),B=y(async t=>{a(s=>s.map(n=>n.id===t?{...n,isRead:!1}:n));try{console.log("[useNotifications] Mark as unread not yet implemented on backend for id:",t)}catch(s){throw console.error("[useNotifications] Failed to mark notification as unread:",s),await o(),s}},[o]),G=y(async()=>{const t=e;a(s=>s.map(n=>({...n,isRead:!0})));try{await S.markAllAsRead()}catch(s){throw console.error("[useNotifications] Failed to mark all notifications as read:",s),a(t),s}},[e,o]);return f(()=>{i>k&&k>0&&c(1)},[i,k]),f(()=>{c(1)},[h]),{notifications:e,filteredNotifications:p,paginatedNotifications:x,unreadCount:D,loading:r,error:b,page:i,pageSize:l,totalPages:k,filter:h,refresh:z,markAsRead:O,markAsUnread:B,markAllAsRead:G,setPage:c,setPageSize:R,setFilter:$}}const{useCallback:A,useEffect:V,useState:X}=await M("react"),C="notifications:preferences",F={mutedTypes:[]};function Z(){try{const e=localStorage.getItem(C);if(!e)return F;const a=JSON.parse(e);return{mutedTypes:Array.isArray(a.mutedTypes)?a.mutedTypes:[]}}catch(e){return console.error("[Preferences] Failed to load from localStorage:",e),F}}function ee(e){try{localStorage.setItem(C,JSON.stringify(e))}catch(a){console.error("[Preferences] Failed to save to localStorage:",a)}}function ce(){const[e,a]=X(Z);V(()=>{ee(e)},[e]);const r=A(i=>e.mutedTypes.includes(i),[e.mutedTypes]),g=A(i=>{a(c=>({mutedTypes:c.mutedTypes.includes(i)?c.mutedTypes.filter(R=>R!==i):[...c.mutedTypes,i]}))},[]),b=A(()=>{a({mutedTypes:["comment","attachment","notification","email","mention"]})},[]),N=A(()=>{a({mutedTypes:[]})},[]);return{mutedTypes:e.mutedTypes,isMuted:r,toggleMute:g,muteAll:b,unmuteAll:N}}export{oe as I,ie as a,ce as b,P as i,re as u};
//# sourceMappingURL=useNotificationPreferences-CXfu0G2v.js.map
