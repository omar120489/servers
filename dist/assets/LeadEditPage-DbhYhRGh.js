import{importShared as L}from"./__federation_fn_import-CJIdJiQv.js";import{j as t}from"./useForkRef-BC7kqYKT.js";import{F,c as W,a as u,b as v}from"./formik.esm-5mQln88F.js";import{M as w}from"./MainCard-BRoTQIrC.js";import{l as T}from"./leads-BgdtH0Oz.js";import{u as P}from"./notistack.esm-68WP7i0D.js";import{i as $}from"./axios-CKLPSsiI.js";import{B as j}from"./Box-DmbfI6Tx.js";import{C as M,d as y}from"./Button-Bgis-uOM.js";import{A as R}from"./Alert-C9XT2yne.js";import{T as U}from"./Typography-DFd_zA1D.js";import{S as V}from"./Stack-B5BVBH1D.js";import{G as o}from"./GridLegacy-DgbSh-o7.js";import{T as c}from"./TextField-HqD_g_zo.js";import{M as S}from"./MenuItem-D9vzE7eA.js";const{useCallback:q,useEffect:z,useMemo:D,useState:E}=await L("react"),{useNavigate:G,useParams:I}=await L("react-router-dom"),O=["New","Contacted","Qualified","Working","Unqualified","Converted"],_=["Web","Referral","Email","Phone","Event","Social"],Q=W().shape({firstName:u().required("First name is required"),lastName:u().required("Last name is required"),email:u().email("Enter a valid email").required("Email is required"),phone:u().nullable(),status:u().required("Status is required"),source:u().nullable(),company:u().nullable(),score:v().typeError("Score must be a number").min(0,"Score must be at least 0").max(100,"Score must be at most 100").nullable(),notes:u().nullable()});function H(e){return{firstName:e.firstName,lastName:e.lastName,email:e.email,phone:e.phone??"",status:e.status??"",source:e.source??"",company:e.company??"",score:e.score===null||e.score===void 0?"":e.score>1?e.score:e.score*100,notes:e.notes??""}}function J(e){const r=e.score===""?null:Number(e.score);return{firstName:e.firstName,lastName:e.lastName,email:e.email,phone:e.phone.trim()===""?null:e.phone.trim(),status:e.status||void 0,source:e.source.trim()===""?null:e.source.trim(),company:e.company.trim()===""?null:e.company.trim(),score:r===null||Number.isNaN(r)?null:r>1?r/100:r,notes:e.notes.trim()===""?null:e.notes.trim()}}function K(e){if(!e)return!1;const r=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[089abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/,l=/^\d+$/;return r.test(e)||l.test(e)}function X(e){if(e&&typeof e=="object"&&"message"in e){const r=e.message;if(r)return r}return"Failed to update lead."}function Y(e){if(e&&typeof e=="object"&&"errors"in e){const r=e.errors;if(r&&typeof r=="object"){const l={};return Object.entries(r).forEach(([f,p])=>{Array.isArray(p)&&p.length>0&&(l[f]=p[0])}),l}}return null}function pe(){const{id:e}=I(),r=G(),{enqueueSnackbar:l}=P(),[f,p]=E(null),[b,N]=E(!0),[x,h]=E(null),g=q(async()=>{if(!K(e)){h({kind:"not-found",message:"The requested lead could not be found."}),N(!1);return}N(!0);try{const m=await T.getLead(e);p(m),h(null)}catch(m){$(m)?m.response?.status===404?h({kind:"not-found",message:"The requested lead could not be found."}):h({kind:"network",message:m.response?.data?.message??"We could not load this lead. Please try again in a moment."}):h({kind:"network",message:"We could not load this lead. Please try again in a moment."})}finally{N(!1)}},[e]);z(()=>{g()},[g]);const k=D(()=>f?H(f):null,[f]),A=q(async(m,i)=>{if(!e){l("Unable to update lead: missing identifier.",{variant:"error"}),i.setSubmitting(!1);return}try{const s=J(m);await T.updateLead(e,s),l("Lead updated successfully.",{variant:"success"}),r(`/leads/${e}`)}catch(s){const a=Y(s);a&&i.setErrors(a),l(X(s),{variant:"error"})}finally{i.setSubmitting(!1)}},[l,e,r]);return t.jsxs(w,{title:"Edit Lead",secondary:t.jsx(y,{variant:"outlined",onClick:()=>r(e?`/leads/${e}`:"/leads"),children:"Cancel"}),children:[b&&t.jsx(j,{sx:{display:"flex",justifyContent:"center",py:6},children:t.jsx(M,{})}),!b&&x&&t.jsx(R,{severity:x.kind==="network"?"error":"warning",children:t.jsxs(j,{sx:{display:"flex",flexDirection:"column",gap:1},children:[t.jsx(U,{variant:"body2",children:x.message}),t.jsxs(j,{sx:{display:"flex",gap:1},children:[x.kind==="network"&&t.jsx(y,{size:"small",onClick:()=>void g(),variant:"outlined",children:"Retry"}),t.jsx(y,{size:"small",variant:"contained",onClick:()=>r("/leads"),children:"Back to Leads"})]})]})}),!b&&!x&&k&&t.jsx(F,{initialValues:k,enableReinitialize:!0,validationSchema:Q,onSubmit:A,children:({handleSubmit:m,values:i,handleChange:s,touched:a,errors:n,isSubmitting:C,dirty:B})=>t.jsx("form",{noValidate:!0,onSubmit:m,children:t.jsxs(V,{spacing:3,children:[t.jsxs(o,{container:!0,spacing:2,children:[t.jsx(o,{xs:12,md:6,children:t.jsx(c,{label:"First Name",name:"firstName",value:i.firstName,onChange:s,error:a.firstName&&!!n.firstName,helperText:a.firstName&&n.firstName,fullWidth:!0,required:!0})}),t.jsx(o,{xs:12,md:6,children:t.jsx(c,{label:"Last Name",name:"lastName",value:i.lastName,onChange:s,error:a.lastName&&!!n.lastName,helperText:a.lastName&&n.lastName,fullWidth:!0,required:!0})}),t.jsx(o,{xs:12,md:6,children:t.jsx(c,{label:"Email",name:"email",type:"email",value:i.email,onChange:s,error:a.email&&!!n.email,helperText:a.email&&n.email,fullWidth:!0,required:!0})}),t.jsx(o,{xs:12,md:6,children:t.jsx(c,{label:"Phone",name:"phone",value:i.phone,onChange:s,error:a.phone&&!!n.phone,helperText:a.phone&&n.phone,fullWidth:!0})}),t.jsx(o,{xs:12,md:6,children:t.jsx(c,{label:"Status",name:"status",value:i.status,onChange:s,error:a.status&&!!n.status,helperText:a.status&&n.status,fullWidth:!0,required:!0,select:!0,children:O.map(d=>t.jsx(S,{value:d,children:d},d))})}),t.jsx(o,{xs:12,md:6,children:t.jsxs(c,{label:"Source",name:"source",value:i.source,onChange:s,error:a.source&&!!n.source,helperText:a.source&&n.source,fullWidth:!0,select:!0,children:[t.jsx(S,{value:"",children:"None"}),_.map(d=>t.jsx(S,{value:d,children:d},d))]})}),t.jsx(o,{xs:12,md:6,children:t.jsx(c,{label:"Company",name:"company",value:i.company,onChange:s,error:a.company&&!!n.company,helperText:a.company&&n.company,fullWidth:!0})}),t.jsx(o,{xs:12,md:6,children:t.jsx(c,{label:"Score (%)",name:"score",value:i.score,onChange:s,error:a.score&&!!n.score,helperText:a.score&&n.score?n.score:"Enter a value from 0 to 100 to represent the lead score.",fullWidth:!0,type:"number",inputProps:{min:0,max:100}})}),t.jsx(o,{xs:12,children:t.jsx(c,{label:"Notes",name:"notes",value:i.notes,onChange:s,error:a.notes&&!!n.notes,helperText:a.notes&&n.notes,fullWidth:!0,multiline:!0,minRows:3})})]}),t.jsxs(j,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[t.jsx(y,{variant:"outlined",onClick:()=>r(e?`/leads/${e}`:"/leads"),disabled:C,children:"Cancel"}),t.jsx(y,{variant:"contained",type:"submit",disabled:C||!B,children:"Save Changes"})]})]})})})]})}export{pe as default};
//# sourceMappingURL=LeadEditPage-DbhYhRGh.js.map
