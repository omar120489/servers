import{importShared as D}from"./__federation_fn_import-ROHmt-Wr.js";import{j as e}from"./useForkRef-BcC6EfDH.js";import{S as W,R as G}from"./Search-Df6iiIHe.js";import{P as H}from"./PersonAddAlt1-d2OIeEVX.js";import{M as Y}from"./MainCard-BN-3sZL8.js";import{l as Q}from"./leads-BlzHCf2S.js";import{B as w}from"./Box-BoOsA6HK.js";import{T as Z}from"./TextField-CqP_YIjN.js";import{I as J}from"./InputAdornment-XCd-Rvcx.js";import{d as C}from"./Button-BSxsv2fQ.js";import{C as k}from"./Chip-Cvckel7e.js";import{A as K}from"./Alert-DviP8MUR.js";import{P as X}from"./Paper-95EUI1Zh.js";import{L as ee}from"./LinearProgress-mmbdlsI0.js";import{b as te,T as re,c as se,d as N,a as ae}from"./TableRow-D5UALSuA.js";import{a as n}from"./TableCell-BjWf2WE4.js";import{T as E}from"./Typography-DjCnPsjL.js";import{T as ne}from"./TablePagination-BQK3mk3q.js";const{useCallback:S,useEffect:oe,useMemo:ie,useState:T}=await D("react"),M={page:1,size:10,search:""};function ce(r){const[p,v]=T(()=>({...M,...r?.initialQuery??{}})),[j,P]=T(null),[y,u]=T(!1),[s,c]=T(null),m=ie(()=>({...M,...p}),[p]),z=S(async o=>{const i=await Q.listLeads(o);P(i),c(null)},[]),f=S(async o=>{u(!0);try{await z(o)}catch(i){throw c(i),i}finally{u(!1)}},[z]);oe(()=>{let o=!0;return u(!0),Q.listLeads(m).then(i=>{o&&(P(i),c(null))}).catch(i=>{o&&c(i)}).finally(()=>{o&&u(!1)}),()=>{o=!1}},[m]);const d=S(o=>{v(i=>({...i,...o}))},[]),b=S(o=>{v(i=>o(i))},[]),L=S(async()=>{await f(m)},[f,m]);return{leads:j?.items??[],data:j,loading:y,error:s,query:m,updateQuery:d,setQuery:b,refetch:L}}const{useCallback:x,useEffect:le,useMemo:I,useState:de}=await D("react"),{Link:R,useSearchParams:he}=await D("react-router-dom"),ue={new:"default",contacted:"info",qualified:"success",working:"info",converted:"success",unqualified:"error"};function me(r){return r?ue[r.toLowerCase()]??"default":"default"}function fe(r){return r==null||Number.isNaN(r)?"—":`${Math.round(r)}%`}function xe(r){return r?new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric"}).format(new Date(r)):"—"}const g=10;function Re(){const[r,p]=he(),v=I(()=>{const t=(l,h)=>{const A=Number(r.get(l));return Number.isFinite(A)&&A>0?A:h},a=l=>{const h=r.get(l);return h&&h.trim().length>0?h:void 0};return{page:t("page",1),size:t("size",g),search:r.get("search")??"",dateFrom:a("dateFrom"),dateTo:a("dateTo"),ownerId:a("ownerId")}},[r]),{leads:j,data:P,loading:y,error:u,query:s,updateQuery:c,refetch:m}=ce({initialQuery:v}),[z,f]=de(s.search??"");le(()=>{const t=s.search??"";f(a=>a===t?a:t)},[s.search]);const d=x(t=>{const a=new URLSearchParams(r);Object.entries(t).forEach(([l,h])=>{h===void 0||h===""?a.delete(l):a.set(l,h)}),p(a)},[r,p]),b=I(()=>{const t=r.get("stage");return t&&t.trim().length>0?t:void 0},[r]),L=x((t,a)=>{const l=a+1;c({page:l}),d({page:String(l),size:String(s.size??g)})},[s.size,d,c]),o=x(t=>{const a=Number(t.target.value)||g;c({page:1,size:a}),d({page:"1",size:String(a)})},[d,c]),i=x(t=>{const a=t.target.value;f(a),c({page:1,search:a});const l=a.trim();d({search:l.length>0?a:void 0,page:"1",size:String(s.size??g)})},[s.size,d,c]),$=x(()=>{m()},[m]),B=I(()=>!!((s.search??"").trim()||s.dateFrom||s.dateTo||s.ownerId||b),[s.dateFrom,s.dateTo,s.ownerId,s.search,b]),q=x(()=>{const t=s.size??g;c({page:1,size:t,search:"",dateFrom:void 0,dateTo:void 0,ownerId:void 0}),f(""),d({page:"1",size:String(t),search:void 0,dateFrom:void 0,dateTo:void 0,ownerId:void 0,stage:void 0})},[s.size,d,c]),F=I(()=>j,[j]),O=P?.total??F.length,_=Math.max(0,(s.page??1)-1),U=s.size??g,V=e.jsx(C,{component:R,to:"/leads/new",variant:"contained",startIcon:e.jsx(H,{}),children:"New Lead"});return e.jsx(Y,{title:"Leads",content:!1,children:e.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:2,p:3},children:[e.jsxs(w,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,alignItems:{xs:"stretch",md:"center"},justifyContent:"space-between"},children:[e.jsx(Z,{fullWidth:!0,placeholder:"Search leads",value:z,onChange:i,InputProps:{startAdornment:e.jsx(J,{position:"start",children:e.jsx(W,{fontSize:"small"})})}}),e.jsxs(w,{sx:{display:"flex",flexDirection:"row",gap:1.5,justifyContent:{xs:"flex-start",md:"flex-end"}},children:[e.jsx(C,{variant:"outlined",startIcon:e.jsx(G,{}),onClick:$,disabled:y,children:"Refresh"}),V]})]}),B&&e.jsx(k,{label:"Active filters",onDelete:q,color:"primary",size:"small",sx:{alignSelf:"flex-start"}}),!!u&&e.jsx(K,{severity:"error",children:u instanceof Error?u.message:"Failed to load leads. Please try again."}),e.jsxs(X,{variant:"outlined",children:[y&&e.jsx(ee,{}),e.jsx(te,{children:e.jsxs(re,{size:"medium",children:[e.jsx(se,{children:e.jsxs(N,{children:[e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Phone"}),e.jsx(n,{children:"Company"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Source"}),e.jsx(n,{align:"right",children:"Score"}),e.jsx(n,{children:"Created"}),e.jsx(n,{align:"right",children:"Actions"})]})}),e.jsx(ae,{children:F.length===0&&!y?e.jsx(N,{children:e.jsx(n,{colSpan:9,align:"center",children:e.jsx(E,{variant:"body2",color:"text.secondary",children:"No leads found."})})}):F.map(t=>e.jsxs(N,{hover:!0,children:[e.jsx(n,{children:e.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(E,{variant:"subtitle1",fontWeight:600,children:[t.firstName," ",t.lastName]}),e.jsxs(E,{variant:"caption",color:"text.secondary",children:["Owner: ",t.ownerId??"—"]})]})}),e.jsx(n,{children:t.email}),e.jsx(n,{children:t.phone??"—"}),e.jsx(n,{children:t.company??"—"}),e.jsx(n,{children:e.jsx(k,{label:t.status??"—",size:"small",color:me(t.status)})}),e.jsx(n,{children:t.source??"—"}),e.jsx(n,{align:"right",children:fe(t.score)}),e.jsx(n,{children:xe(t.createdAt)}),e.jsx(n,{align:"right",children:e.jsxs(w,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(C,{component:R,to:`/leads/${t.id}`,size:"small",children:"View"}),e.jsx(C,{component:R,to:`/leads/${t.id}/edit`,size:"small",color:"secondary",children:"Edit"})]})})]},t.id))})]})}),e.jsx(ne,{component:"div",count:O,page:_,onPageChange:L,rowsPerPage:U,onRowsPerPageChange:o,rowsPerPageOptions:[5,10,25,50]})]})]})})}export{Re as default};
//# sourceMappingURL=LeadsListPage-DkKo1FhD.js.map
