import{importShared as M}from"./__federation_fn_import-ROHmt-Wr.js";import{j as t}from"./useForkRef-BcC6EfDH.js";import{S as U,R as B}from"./Search-Df6iiIHe.js";import{M as $}from"./MainCard-BN-3sZL8.js";import{d as T}from"./deals-iLL9qn1F.js";import{B as h}from"./Box-BoOsA6HK.js";import{T as p}from"./Typography-DjCnPsjL.js";import{C as A}from"./Chip-Cvckel7e.js";import{d as w}from"./Button-BSxsv2fQ.js";import{T as O}from"./TextField-CqP_YIjN.js";import{I as V}from"./InputAdornment-XCd-Rvcx.js";import{A as q}from"./Alert-DviP8MUR.js";import{D as G}from"./DataGrid-DNkeZyx1.js";const{useCallback:y,useEffect:_,useMemo:Y,useState:C}=await M("react"),k={page:1,size:10,search:""};function Z(r){const[i,b]=C(()=>({...k,...r?.initialQuery??{}})),[x,g]=C(null),[S,d]=C(!1),[a,c]=C(null),f=Y(()=>({...k,...i}),[i]),u=y(async o=>{const s=await T.listDeals(o);g(s),c(null)},[]),v=y(async o=>{d(!0);try{await u(o)}catch(s){throw c(s),s}finally{d(!1)}},[u]);_(()=>{let o=!0;return d(!0),T.listDeals(f).then(s=>{o&&(g(s),c(null))}).catch(s=>{o&&c(s)}).finally(()=>{o&&d(!1)}),()=>{o=!1}},[f]);const F=y(o=>{b(s=>({...s,...o}))},[]),N=y(o=>{b(s=>({...s,...o(s)}))},[]),W=y(async()=>{await v(f)},[v,f]);return{deals:x?.items??[],data:x,loading:S,error:a,query:f,updateQuery:F,setQuery:N,refetch:W}}const{useCallback:j,useMemo:D}=await M("react"),{Link:z,useSearchParams:H}=await M("react-router-dom"),I=10;function J(r){return r==null||Number.isNaN(r)?"—":new Intl.NumberFormat(void 0,{style:"currency",currency:"USD",maximumFractionDigits:0}).format(r)}function K(r){if(r==null)return"—";const i=r>1?r:r*100;return`${Math.round(i)}%`}function E(r){return r?new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric"}).format(new Date(r)):"—"}function X(r){if(!r)return"default";const i=r.toLowerCase();return i.includes("won")?"success":i.includes("lost")?"error":i.includes("hold")||i.includes("pending")?"warning":i.includes("negotiation")||i.includes("proposal")?"info":"default"}function fe(){const[r,i]=H(),b=D(()=>{const e=(l,m)=>{const P=Number(r.get(l));return Number.isFinite(P)&&P>0?P:m},n=l=>{const m=r.get(l);return m&&m.trim().length>0?m:void 0};return{page:e("page",1),size:e("size",I),search:r.get("search")??"",dateFrom:n("dateFrom"),dateTo:n("dateTo"),stage:n("stage"),ownerId:n("ownerId")}},[r]),{deals:x,data:g,loading:S,error:d,query:a,updateQuery:c,refetch:f}=Z({initialQuery:b}),u=j(e=>{const n=new URLSearchParams(r);Object.entries(e).forEach(([l,m])=>{m===void 0||m===""?n.delete(l):n.set(l,m)}),i(n)},[r,i]),v=t.jsx(w,{component:z,to:"/deals/new",variant:"contained",children:"New Deal"}),F=t.jsx(w,{component:z,to:"/reports",size:"small",variant:"text",children:"View reports"}),N=D(()=>({page:Math.max(0,(a.page??1)-1),pageSize:a.size??I}),[a.page,a.size]),W=j(e=>{const n=e.page+1,l=e.pageSize;c({page:n,size:l}),u({page:String(n),size:String(l)})},[u,c]),o=j(e=>{const n=e.target.value;c({search:n,page:1});const l=n.trim();u({search:l.length>0?n:void 0,page:"1",size:String(a.size??I)})},[a.size,u,c]),s=j(()=>{f()},[f]),L=D(()=>!!((a.search??"").trim()||a.dateFrom||a.dateTo||a.stage||a.ownerId),[a.dateFrom,a.dateTo,a.ownerId,a.search,a.stage]),R=j(()=>{const e=a.size??I;c({page:1,size:e,search:"",dateFrom:void 0,dateTo:void 0,stage:void 0,ownerId:void 0}),u({page:"1",size:String(e),search:void 0,dateFrom:void 0,dateTo:void 0,stage:void 0,ownerId:void 0})},[a.size,u,c]),Q=D(()=>[{field:"name",headerName:"Deal",flex:1.2,minWidth:200,renderCell:e=>t.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[t.jsx(p,{variant:"subtitle1",fontWeight:600,noWrap:!0,children:e.row.name}),t.jsxs(p,{variant:"caption",color:"text.secondary",noWrap:!0,children:["Owner: ",e.row.ownerId??"—"]})]})},{field:"amount",headerName:"Amount",flex:.6,minWidth:140,type:"number",renderCell:e=>t.jsx(p,{variant:"body2",noWrap:!0,children:J(e.row.amount)})},{field:"stage",headerName:"Stage",flex:.5,minWidth:140,renderCell:e=>t.jsx(A,{label:e.row.stage||"—",size:"small",variant:"outlined"})},{field:"status",headerName:"Status",flex:.5,minWidth:140,renderCell:e=>t.jsx(A,{label:e.row.status||"—",size:"small",color:X(e.row.status)})},{field:"probability",headerName:"Probability",flex:.4,minWidth:120,renderCell:e=>t.jsx(p,{variant:"body2",noWrap:!0,children:K(e.row.probability)})},{field:"closeDate",headerName:"Close Date",flex:.6,minWidth:150,renderCell:e=>t.jsx(p,{variant:"body2",noWrap:!0,children:E(e.row.closeDate)})},{field:"updatedAt",headerName:"Updated",flex:.6,minWidth:150,renderCell:e=>t.jsx(p,{variant:"body2",noWrap:!0,children:E(e.row.updatedAt)})},{field:"actions",headerName:"Actions",sortable:!1,filterable:!1,minWidth:160,align:"right",disableColumnMenu:!0,renderCell:e=>{const n=t.jsx(w,{component:z,to:`/deals/${e.row.id}`,size:"small",children:"View"}),l=t.jsx(w,{component:z,to:`/deals/${e.row.id}/edit`,size:"small",color:"secondary",children:"Edit"});return t.jsxs(h,{sx:{display:"flex",flexDirection:"row",gap:1},children:[n,l]})}}],[]);return t.jsx($,{title:"Deals",content:!1,children:t.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:2,p:3},children:[t.jsxs(h,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,alignItems:{xs:"stretch",md:"center"},justifyContent:"space-between"},children:[t.jsx(O,{fullWidth:!0,placeholder:"Search deals",value:a.search??"",onChange:o,slotProps:{input:{startAdornment:t.jsx(V,{position:"start",children:t.jsx(U,{fontSize:"small"})})}}}),t.jsxs(h,{sx:{display:"flex",flexDirection:"row",gap:1.5,justifyContent:{xs:"flex-start",md:"flex-end"}},children:[t.jsx(w,{variant:"outlined",startIcon:t.jsx(B,{}),onClick:s,disabled:S,children:"Refresh"}),v]})]}),L&&t.jsx(A,{label:"Active filters",onDelete:R,color:"primary",size:"small",sx:{alignSelf:"flex-start"}}),!!d&&t.jsxs(q,{severity:"error",children:[d instanceof Error?d.message:"Failed to load deals. Please try again.",d instanceof Error&&d.stack&&t.jsx(p,{component:"pre",variant:"caption",sx:{mt:1,whiteSpace:"pre-wrap"},children:d.stack})]}),t.jsx(h,{sx:{width:"100%"},children:t.jsx(G,{disableColumnMenu:!0,disableRowSelectionOnClick:!0,rows:x,columns:Q,loading:S,getRowId:e=>e.id,paginationMode:"server",paginationModel:N,onPaginationModelChange:W,rowCount:g?.total??x.length,pageSizeOptions:[5,10,25,50],sx:{"& .MuiDataGrid-cell":{outline:"none !important"}}})}),t.jsxs(h,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1,alignItems:{xs:"flex-start",sm:"center"}},children:[t.jsxs(p,{variant:"caption",color:"text.secondary",children:["Showing ",x.length," of ",g?.total??0," deals"]}),t.jsx(h,{children:F})]})]})})}export{fe as default};
//# sourceMappingURL=DealsListPage-DJBSCwdW.js.map
